<ng-container *ngIf="task$ | async as task; else loading">
	<div class="row">
		<div class="col-md-8 m-auto task-wrapper">
			<h2 class="mb-3">
				<span class="cursor-pointer" (click)="goBack()">&larr;&nbsp;</span
				>{{ task.title | capitalizeFirstLetter }}
			</h2>
			<p class="text-muted">- by {{ task.username! | formatUsername }}</p>
			<div class="d-inline-flex w-full margin-bottom-15">
				<div class="margin-right-20">
					<label class="fw-medium"><span>Status:</span></label>
					<div class="d-flex align-items-center">
						<div
							class="status-circle"
							[ngClass]="{
								'status-circle-pending': task.status === 'pending',
								'status-circle-doing': task.status === 'doing',
								'status-circle-reviewing': task.status === 'reviewing',
								'status-circle-completed': task.status === 'completed'
							}"
						></div>
						<span>{{ task.status | capitalizeFirstLetter }}</span>
					</div>
				</div>
				<div>
					<label class="fw-medium"><span>Priority:</span></label>
					<div class="d-flex align-items-center">
						<div
							class="status-circle"
							[ngClass]="{
								'status-circle-low': task.priority === 'low',
								'status-circle-medium': task.priority === 'medium',
								'status-circle-high': task.priority === 'high'
							}"
						></div>
						<span>{{ task.priority | capitalizeFirstLetter }}</span>
					</div>
				</div>
			</div>
			<div *ngIf="task.description" class="description-area">
				<p class="text-justify">{{ task.description }}</p>
			</div>
			<div class="row mt-2">
				<div class="col-md-2">
					<label class="fw-medium"><span>Due:</span></label>
					<div class="d-flex align-items-center">
						<span>{{ task.dueDate }}</span>
					</div>
				</div>
				<div class="col-md-2">
					<label class="fw-medium"><span>Created:</span></label>
					<div class="d-flex align-items-center">
						<span>{{ task.createdDate }}</span>
					</div>
				</div>
				<div class="col-md-2">
					<label class="fw-medium"><span>Updated:</span></label>
					<div class="d-flex align-items-center">
						<span>{{ task.updatedDate }}</span>
					</div>
				</div>
				<div class="col-md-2">
					<div class="d-flex align-items-center">
						<span *ngIf="task.assignedTo && task.assignedTo.length > 0">
							<span class="fw-medium">Assigned to:</span>
							{{ task.assignedTo | formatUsernames }}
						</span>
					</div>
				</div>
			</div>
			<div class="mt-4 float-end w-fit">
				<button class="btn btn-sm btn-link me-2" (click)="goToTaskUpdate(task.id)">
					<i class="bi bi-pencil btn-list btn-edit"></i> Update
				</button>
				<button class="btn btn-sm btn-outline-danger" (click)="deleteTask()">
					Ã— Delete
				</button>
			</div>
		</div>
	</div>
	<div class="row mt-3">
		<div class="col-md-8 m-auto task-wrapper">
			<h5 class="mb-3">Attachment:</h5>
			<div class="d-inline-flex w-full" *ngIf="task.attachment">
				<img src="./attachment.jpg" class="attachment-img" />
				<div class="w-full attachment-box">
					<p class="mr-auto">{{ task.attachment }}</p>
					<button
						class="btn btn-link btn-del-attachment"
						(click)="deleteAttachment()"
					>
						&times;
					</button>
				</div>
			</div>
			<div class="" *ngIf="!task.attachment">
				<label for="attachment" class="form-label">Choose Attachment:</label>
				<input
					type="file"
					id="attachment"
					(change)="onFileSelected($event)"
					class="form-control"
				/>
			</div>
		</div>
	</div>
	<div class="row mt-3">
		<div class="col-md-8 m-auto task-wrapper">
			<h5 class="mb-3">Comments:</h5>
			<div class="w-full">
				<div class="input-group mb-3">
					<input type="text" #commentInput class="form-control comment-input-field" placeholder="Write your comment here..." aria-label="Write your comment here..." aria-describedby="button-addon2" [(ngModel)]="newComment" (keyup)="handleAtSymbol($event)">
					<div class="mention-box" *ngIf="showMentionBox && filteredUsernames.length > 0">
						<ul class="mention-ul">
							<li class="mention-li" *ngFor="let username of filteredUsernames"
								(click)="selectUsername(username)">
								{{ username | formatUsername }}
							</li>
						</ul>
					</div>
					<div class="input-group-append">
						<button class="btn btn-outline-secondary" type="button" id="button-addon2" (click)="postComment()">Post</button>
					</div>
				</div>
			</div>
			<div class="w-full" *ngIf="task.comments.length !== 0">
				<ul class="comments-ul">
					<li *ngFor="let comment of task.comments">
						<div class="d-inline-flex w-full">
							<p class="mr-auto">
								<span class="fw-medium">{{ (comment.username | formatUsername) + ": " }}</span
								>
								<span [innerHTML]="highlightUsername(comment.body)"></span>
							</p>
							<button *ngIf="usn === comment.username" class="btn btn-link btn-del-attachment" (click)="deleteComment(comment.id)">&times;</button>
						</div>
					</li>
				</ul>
			</div>
			<div class="w-full" *ngIf="task.comments.length === 0">
				<p class="w-full m-auto text-center">No comments here</p>
			</div>
		</div>
	</div>
</ng-container>

<ng-template #loading>
	<p class="mt-3">Loading...</p>
</ng-template>
